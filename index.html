<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>TRANG CH·ª¶ NH√ÇN VI√äN</title>
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="theme-color" content="#0078d4">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
<link href="https://fonts.googleapis.com/css2?family=Be+Vietnam+Pro:wght@400;600;700&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
    body { font-family: 'Be Vietnam Pro', sans-serif; background: #f0f2f5; margin: 0; padding: 0; min-height: 100vh; display: flex; flex-direction: column; }
    
    /* Header */
    .app-header { 
        background: linear-gradient(135deg, #0078d4, #005a9e); 
        color: white; padding: 20px; padding-top: 50px; 
        box-shadow: 0 4px 15px rgba(0,0,0,0.1); 
        border-radius: 0 0 25px 25px; margin-bottom: 10px;
    }
    .app-header h2 { margin: 0; font-size: 22px; }
    .app-header p { margin: 5px 0 0; font-size: 14px; opacity: 0.9; }

    /* Container */
    .container { padding: 20px; flex: 1; padding-bottom: 80px; display: none; /* ·∫®n m·∫∑c ƒë·ªãnh ch·ªù load */ }
    .section-title { font-size: 13px; color: #666; margin: 20px 0 10px 5px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px; }
    .menu-grid { display: grid; grid-template-columns: 1fr; gap: 15px; }
    
    /* Card Design */
    .menu-card { 
        background: white; padding: 15px 20px; border-radius: 16px; 
        box-shadow: 0 4px 10px rgba(0,0,0,0.05); 
        display: flex; align-items: center; gap: 15px; 
        cursor: pointer; transition: all 0.2s; 
        text-decoration: none; color: inherit; position: relative; overflow: hidden;
    }
    .menu-card:active { transform: scale(0.98); background: #fafafa; }
    .hidden-item { display: none !important; }
    .menu-card.disabled { opacity: 0.6; pointer-events: none; filter: grayscale(100%); }

    /* Icons & Colors */
    .icon-box { width: 50px; height: 50px; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 22px; color: white; box-shadow: 0 4px 8px rgba(0,0,0,0.15); flex-shrink: 0; }
    .card-text h3 { margin: 0; font-size: 16px; color: #333; font-weight: 600; }
    .card-text p { margin: 2px 0 0; font-size: 13px; color: #888; }
    
    .bg-date { background: linear-gradient(135deg, #FF9800, #F57C00); }
    .bg-stock { background: linear-gradient(135deg, #2196F3, #1976D2); }
    .bg-leave { background: linear-gradient(135deg, #4CAF50, #388E3C); }
    .bg-admin { background: linear-gradient(135deg, #673AB7, #512DA8); }
    .bg-wheel { background: linear-gradient(135deg, #E91E63, #C2185B); }
    .bg-lucky { background: linear-gradient(135deg, #FFC107, #FFB300); }

    /* Badge & Footer */
    .status-badge { font-size: 10px; font-weight: bold; padding: 3px 8px; border-radius: 10px; position: absolute; top: 10px; right: 10px; text-transform: uppercase; }
    .badge-live { background: #ffebee; color: #d32f2f; animation: pulse 2s infinite; }
    .badge-soon { background: #e3f2fd; color: #1976d2; }
    .badge-ended { background: #f5f5f5; color: #757575; }
    @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.7; } 100% { opacity: 1; } }
    .footer { text-align: center; padding: 20px; color: #aaa; font-size: 12px; margin-top: auto; }

    /* M√†n h√¨nh Loading */
    #loading-screen { position: fixed; inset: 0; background: #f0f2f5; display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 999; }
    .spinner { width: 40px; height: 40px; border: 4px solid #ddd; border-top-color: #0078d4; border-radius: 50%; animation: spin 1s linear infinite; margin-bottom: 10px; }
    @keyframes spin { to { transform: rotate(360deg); } }
	
	/* Th√™m font ƒë∆°n c√°ch (monospace) cho s·ªë ƒë·ªÉ kh√¥ng b·ªã gi·∫≠t khi s·ªë ch·∫°y */
	.status-badge { 
		font-size: 11px; font-weight: bold; padding: 4px 8px; border-radius: 10px; 
		position: absolute; top: 10px; right: 10px; text-transform: uppercase;
		font-variant-numeric: tabular-nums; /* Gi√∫p s·ªë th·∫≥ng h√†ng */
		letter-spacing: 0.5px;
		z-index: 2;
	}
</style>
</head>
<body>

    <div id="loading-screen">
        <div class="spinner"></div>
        <p style="color: #666; font-size: 14px;">ƒêang t·∫£i d·ªØ li·ªáu...</p>
    </div>

    <div class="app-header">
        <h2>Xin ch√†o! üëã</h2>
        <p>C·ªïng th√¥ng tin & Ti·ªán √≠ch nh√¢n vi√™n</p>
    </div>

    <div class="container" id="main-content">
        
        <div class="section-title">C√¥ng c·ª• l√†m vi·ªác</div>
        <div class="menu-grid">
            <a href="#" id="btn-date" class="menu-card"><div class="icon-box bg-date"><i class="fas fa-calendar-day"></i></div><div class="card-text"><h3>T√≠nh H·∫°n S·ª≠ D·ª•ng</h3><p>C√¥ng c·ª• t√≠nh date</p></div></a>
            <a href="#" id="btn-stock" class="menu-card"><div class="icon-box bg-stock"><i class="fas fa-box-open"></i></div><div class="card-text"><h3>Tra C·ª©u m·∫´u t·ªß</h3><p>Xem h√¨nh ·∫£nh t·ªß</p></div></a>
            <a href="#" id="btn-leave" class="menu-card"><div class="icon-box bg-leave"><i class="fas fa-user-clock"></i></div><div class="card-text"><h3>Xem ph√©p & b√π</h3><p>ƒêƒÉng k√Ω ngh·ªâ</p></div></a>
        </div>

        <div class="section-title" id="sec-event">S·ª± ki·ªán & Gi·∫£i tr√≠</div>
        <div class="menu-grid">
            <a href="#" id="btn-wheel" class="menu-card"><div class="icon-box bg-wheel"><i class="fas fa-dharmachakra"></i></div><div class="card-text"><h3>V√≤ng Quay May M·∫Øn</h3><p>Th·ª≠ v·∫≠n may ngay</p></div></a>
            <a href="#" id="btn-lucky" class="menu-card"><div class="icon-box bg-lucky"><i class="fas fa-gift"></i></div><div class="card-text"><h3>H√°i L·ªôc ƒê·∫ßu NƒÉm</h3><p>Nh·∫≠n l√¨ x√¨ T·∫øt</p></div></a>
        </div>

        <div class="section-title" id="sec-admin">Qu·∫£n tr·ªã</div>
        <div class="menu-grid">
            <a href="#" id="btn-admin" class="menu-card">
                <div class="icon-box bg-admin"><i class="fas fa-cogs"></i></div>
                <div class="card-text"><h3>Admin System</h3><p>C·∫•u h√¨nh h·ªá th·ªëng</p></div>
            </a>
        </div>

    </div>

    <div class="footer">C·ªîNG TH√îNG TIN N·ªòI B·ªò ¬© 2025</div>

<script>
    // ============================================================
    // 1. K·∫æT N·ªêI SUPABASE
    // ============================================================
    const SUPABASE_URL = 'https://gpmuckoydhrokpioltem.supabase.co';
    const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdwbXVja295ZGhyb2twaW9sdGVtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU3MTMzNTcsImV4cCI6MjA4MTI4OTM1N30.Fqe5U2hm_fERI6ZLc_FQ1SMh5F4sYOrxr8JqLlwLKI0';

    const _supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

    // ============================================================
    // 2. H√ÄM T·∫¢I C·∫§U H√åNH
    // ============================================================
    
    async function fetchConfig() {
        try {
            let { data, error } = await _supabase
                .from('app_settings')
                .select('config_data')
                .eq('id', 1)
                .maybeSingle(); 

            if (error) throw error;
            
            if (!data) {
                console.error("Kh√¥ng t√¨m th·∫•y d·ªØ li·ªáu c·∫•u h√¨nh!");
                alert("L·ªói: Ch∆∞a c√≥ d·ªØ li·ªáu c·∫•u h√¨nh tr√™n Server!");
                return;
            }

            if (data.config_data) {
                initApp(data.config_data);
            }
        } catch (err) {
            console.error('L·ªói t·∫£i c·∫•u h√¨nh:', err);
        } finally {
            document.getElementById('loading-screen').style.display = 'none';
            document.getElementById('main-content').style.display = 'block';
        }
    }

    // ============================================================
    // 3. LOGIC HI·ªÇN TH·ªä & ƒê·∫æM NG∆Ø·ª¢C
    // ============================================================

    function initApp(config) {
        const adminLink = "admin.html";
        
        setupButton('btn-date', config.features.date, config.urls.date);
        setupButton('btn-stock', config.features.stock, config.urls.stock);
        setupButton('btn-leave', config.features.leave, config.urls.leave);
        setupButton('btn-admin', config.features.admin, adminLink);

        setupEventButton('btn-wheel', config.features.wheel, config.urls.wheel, config.events.wheel);
        setupEventButton('btn-lucky', config.features.lucky, config.urls.lucky, config.events.lucky);

        checkSectionVisibility('sec-admin', ['btn-admin']);
        checkSectionVisibility('sec-event', ['btn-wheel', 'btn-lucky']);
    }

    function setupButton(id, isActive, url) {
        const el = document.getElementById(id);
        if (!el) return;
        if (!isActive) {
            el.classList.add('hidden-item');
        } else {
            el.classList.remove('hidden-item');
            el.href = url && url.trim() !== "" ? url : "#";
            if(el.getAttribute('href') === "#" && id !== 'btn-admin') {
                el.onclick = () => alert("Ch·ª©c nƒÉng ƒëang b·∫£o tr√¨!");
            }
        }
    }

    function setupEventButton(id, isActive, url, eventConfig) {
        const el = document.getElementById(id);
        if (!el) return;

        // X√≥a badge c≈© n·∫øu c√≥ (ƒë·ªÉ tr√°nh tr√πng l·∫∑p khi reload)
        const oldBadges = el.querySelectorAll('.status-badge');
        oldBadges.forEach(b => b.remove());
        el.classList.remove('hidden-item', 'disabled');
        el.onclick = null; // Reset s·ª± ki·ªán click

        if (!isActive) {
            el.classList.add('hidden-item');
            return;
        }

        // N·∫øu kh√¥ng d√πng th·ªùi gian -> M·ªü lu√¥n
        if (!eventConfig.useTime) {
            el.href = url || "#";
            return;
        }

        const now = new Date().getTime();
        const start = new Date(eventConfig.start).getTime();
        const end = new Date(eventConfig.end).getTime();
        
        // --- TR∆Ø·ªúNG H·ª¢P 1: CH∆ØA ƒê·∫æN GI·ªú (ƒê·∫æM NG∆Ø·ª¢C) ---
        if (now < start) {
            // T·∫°o ID ri√™ng cho badge ƒë·ªÉ c·∫≠p nh·∫≠t s·ªë
            const badgeId = `timer-${id}`;
            
            // Ch√®n Badge ƒë·∫øm ng∆∞·ª£c
            el.innerHTML += `<span id="${badgeId}" class="status-badge badge-soon">ƒêang t·∫£i...</span>`;
            
            // Kh√≥a n√∫t
            el.classList.add('disabled');
            el.removeAttribute('href');

            // B·∫Øt ƒë·∫ßu ch·∫°y ƒë·ªìng h·ªì ƒë·∫øm ng∆∞·ª£c
            startCountdown(badgeId, start, el, url, eventConfig.msgLive);
        } 
        // --- TR∆Ø·ªúNG H·ª¢P 2: ƒêANG DI·ªÑN RA ---
        else if (now >= start && now <= end) {
            el.innerHTML += `<span class="status-badge badge-live">${eventConfig.msgLive} <i class="fas fa-bolt"></i></span>`;
            el.href = url || "#";
        } 
        // --- TR∆Ø·ªúNG H·ª¢P 3: ƒê√É K·∫æT TH√öC ---
        else {
            el.innerHTML += `<span class="status-badge badge-ended">${eventConfig.msgAfter}</span>`;
            el.classList.add('disabled');
            el.removeAttribute('href');
        }
    }

    // --- H√ÄM X·ª¨ L√ù ƒê·∫æM NG∆Ø·ª¢C ---
    function startCountdown(badgeId, startTime, btnElement, targetUrl, liveMsg) {
        // C·∫≠p nh·∫≠t m·ªói 1 gi√¢y
        const x = setInterval(function() {
            const now = new Date().getTime();
            const distance = startTime - now;

            const badgeEl = document.getElementById(badgeId);
            if(!badgeEl) { clearInterval(x); return; } // N·∫øu element b·ªã x√≥a th√¨ d·ª´ng

            // Logic t√≠nh to√°n th·ªùi gian
            const days = Math.floor(distance / (1000 * 60 * 60 * 24));
            const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((distance % (1000 * 60)) / 1000);

            // Format hi·ªÉn th·ªã
            let text = "";
            if (days > 0) {
                text = `M·ªü sau: ${days} ng√†y ${hours}h`;
            } else {
                // Th√™m s·ªë 0 ƒë·∫±ng tr∆∞·ªõc n·∫øu nh·ªè h∆°n 10 (VD: 09:05:01)
                const h = hours < 10 ? "0" + hours : hours;
                const m = minutes < 10 ? "0" + minutes : minutes;
                const s = seconds < 10 ? "0" + seconds : seconds;
                text = `M·ªü sau: ${h}:${m}:${s}`;
            }

            badgeEl.innerText = text;

            // --- KHI H·∫æT GI·ªú (ƒê·∫æM V·ªÄ 0) ---
            if (distance < 0) {
                clearInterval(x); // D·ª´ng ƒë·ªìng h·ªì
                
                // M·ªü kh√≥a giao di·ªán ngay l·∫≠p t·ª©c
                badgeEl.className = "status-badge badge-live";
                badgeEl.innerHTML = `${liveMsg} <i class="fas fa-bolt"></i>`;
                
                btnElement.classList.remove('disabled');
                btnElement.href = targetUrl || "#";
                
                // Hi·ªáu ·ª©ng rung nh·∫π b√°o hi·ªáu
                btnElement.style.animation = "pulse 0.5s";
            }
        }, 1000);
    }

    function checkSectionVisibility(sectionId, childrenIds) {
        const section = document.getElementById(sectionId);
        const children = childrenIds.map(id => document.getElementById(id));
        const hasVisibleChild = children.some(child => child && !child.classList.contains('hidden-item'));
        if (section) section.style.display = hasVisibleChild ? 'block' : 'none';
    }

    // Ch·∫°y app
    fetchConfig();

</script>
</body>

</html>
